import{d as S,m as b,c as E,o as m,a as h,l as g,w as I,v as R,b as f,t as y,F as N,r as C,k as V,h as _,x as A,j as B,u as D}from"./chunks/framework.GMhoYFqv.js";const L='(function(){"use strict";const n=[0,1/0,NaN,Number.MIN_VALUE,Number.MAX_VALUE].flatMap(t=>[t,-t]),s=new DataView(new ArrayBuffer(8));function i(){const t=0|n.length*3*Math.random();return t<n.length?n[t]:(s.setUint32(0,Math.random()*4294967296),s.setUint32(4,Math.random()*4294967296),s.getFloat64(0))}self.onmessage=({data:t})=>{const[o,f]=t,l=new Function(...o,`return ${f}`);let e=0;setInterval(()=>{const c=e+100;for(;e++,e<c;){const r=[];for(let a=0;a<o.length;a++)r.push(i());if(!l(...r)){self.postMessage({type:"fail",arg:r,count:e}),self.close();return}}self.postMessage({type:"ok",count:e})},0)}})();\n',O=typeof self<"u"&&self.Blob&&new Blob([L],{type:"text/javascript;charset=utf-8"});function P(e){let n;try{if(n=O&&(self.URL||self.webkitURL).createObjectURL(O),!n)throw"";const o=new Worker(n,{name:e==null?void 0:e.name});return o.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(n)}),o}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(L),{name:e==null?void 0:e.name})}finally{n&&(self.URL||self.webkitURL).revokeObjectURL(n)}}const j={"?":[10,11],"||":[20,21],"&&":[30,31],"=":[50,51],"==":[50,51],"<":[50,51],">":[50,51],"<=":[50,51],">=":[50,51],"+":[60,61],"-":[60,61],"*":[70,71],"/":[70,71],"%":[70,71],"^":[91,90],"**":[91,90]},x={"!":40,"+":80,"-":80},M=new RegExp(`(?:${[["num","[0-9]+(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?"],["nm","\\p{XIDS}\\p{XIDC}*"],["sym",[..."(,:)",...Object.keys(j),...Object.keys(x)].sort((e,n)=>n.length-e.length).map(e=>e.replace(/([()|/+*^?])/g,"\\$1")).join("|")],["eof","$"],["err",".*"]].map(([e,n])=>`(?<${e}>${n})`).join("|")})\\s*`,"uy");function F(e){const n=[];for(e=e.trimStart(),M.lastIndex=0;;){const o=M.exec(e).groups;if(o.num!=null)n.push(["num",Number(o.num)]);else if(o.nm!=null)n.push(["nm",o.nm]);else if(o.sym!=null)n.push(["sym",o.sym]);else{if(o.eof!=null)return n;throw`无法解析："${o.err}"`}}}function k(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function J(e){let n=0;function o(){return e[n]??["eof","EOF"]}function t(){const c=o();return n++,c}function i(c,r){return c[0]=="sym"&&c[1]==r}const u=s(0);if(o()[0]!="eof")throw`应结束而非 "${o()[1]}"`;return u;function s(c){let r=t(),l;if(r[0]=="eof")throw"不应结束";if(r[0]!="sym")l=r[1];else if(r[1]=="("){if(l=s(0),r=t(),!i(r,")"))throw`应为右括号而非 "${r[1]}"`}else{if(!k(x,r[1]))throw`"${r[1]}" 不是前缀运算`;const a=s(x[r[1]]);l=["un",r[1],a]}for(;r=o(),r[0]!="eof";){if(i(r,"(")){if(typeof l!="string")throw`应为函数而非 ${d(l)}`;t();const p=[];if(i(o(),")"))t();else for(;p.push(s(0)),r=t(),!i(r,")");)if(!i(r,","))throw`应为逗号或右括号而非 "${r[1]}"`;l=["fn",l,p];continue}if(r[0]!="sym"||!k(j,r[1]))break;const[a,$]=j[r[1]];if(a<c)break;if(t(),r[1]=="?"){const p=s(0);if(r=t(),!i(r,":"))throw`应为冒号而非 "${r[1]}"`;l=["cond",l,p,s($)]}else{const p=s($);l=["bin",r[1],l,p]}}return l}}function d(e){return Array.isArray(e)?e[0]=="fn"?`${e[1]}(${e[2].map(d).join(", ")})`:e[0]=="un"?`(${e[1]}${d(e[2])})`:e[0]=="bin"?`(${d(e[2])} ${e[1]} ${d(e[3])})`:`(${d(e[1])} ? ${d(e[2])} : ${d(e[3])})`:String(e)}const X={NaN:NaN,Infinity:1/0,E:Math.E,PI:Math.PI},w={abs:1,acos:1,acosh:1,asin:1,asinh:1,atan:1,atanh:1,cbrt:1,ceil:1,cos:1,cosh:1,exp:1,expm1:1,floor:1,fround:1,log:1,log1p:1,log10:1,log2:1,round:1,sign:1,sin:1,sinh:1,sqrt:1,tan:1,tanh:1,trunc:1,atan2:2,pow:2,hypot:-1,max:-1,min:-1};function T(e){function n(t,i,u){if(i!=u)throw`${d(t)} 应为 ${i} 而非 ${u}`}n(e,"bool",o(e));function o(t){if(!Array.isArray(t))return"num";if(t[0]=="fn")return t[2].forEach(u=>n(u,"num",o(u))),"num";if(t[0]=="un"){const u=t[1]=="!"?"bool":"num";return n(t[2],u,o(t[2])),u}if(t[0]=="bin"){const u=t[1]=="&&"||t[1]=="||",s=t[1]=="="||t[1]=="==",c=["<",">","<=",">="].includes(t[1]),r=o(t[2]);return u?n(t[2],"bool",r):s||n(t[2],"num",r),n(t[3],r,o(t[3])),u||s||c?"bool":"num"}n(t[1],"bool",o(t[1]));const i=o(t[2]);return n(t[3],i,o(t[3])),i}}function v(e,n){if(typeof e=="number")return String(e);if(typeof e=="string")return k(X,e)?String(e):(n[e]=1,e);if(e[0]=="fn"){if(!k(w,e[1]))throw`"${e[1]}" 不是函数`;if(w[e[1]]!=-1&&w[e[1]]!=e[2].length)throw`需要 ${w[e[1]]} 个参数，但给了 ${e[2].length} 个`;const o=e[2].map(t=>v(t,n)).join(", ");return`Math.${e[1]}(${o})`}if(e[0]=="un")return`(${e[1]}${v(e[2],n)})`;if(e[0]=="bin"){const o=v(e[2],n),t=v(e[3],n);switch(e[1]){case"^":return`(${o} ** ${t})`;case"=":return`Object.is(${o}, ${t})`;case"==":return`(${o} === ${t})`;case"!=":return`(${o} !== ${t})`;default:return`(${o} ${e[1]} ${t})`}}return`(${v(e[1],n)} ? ${v(e[2],n)} : ${v(e[3],n)})`}function U(e){try{const n={},o=J(F(e));return T(o),{kind:"ok",expr:v(o,n),args:Object.keys(n)}}catch(n){return{kind:"err",e:n}}}const W={key:0},q={key:1},K=["disabled"],z=["disabled"],G={key:2},H={key:3},Q=S({__name:"Main",setup(e){const n=b("x + y = y + x"),o=b(U(n.value).args),t=E(()=>U(n.value)),i=b(0),u=b(),s=b();function c(){if(t.value.kind=="err")return;i.value=0,o.value=t.value.args,u.value=void 0,r();const l=new P;s.value=l,l.postMessage([t.value.args,t.value.expr]),l.onmessage=({data:a})=>{i.value=a.count,a.type=="fail"&&(r(),u.value=a.arg)}}function r(){var l;(l=s.value)==null||l.terminate(),s.value=void 0}return(l,a)=>(m(),h(N,null,[a[4]||(a[4]=g(" 表达式：")),I(f("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=$=>n.value=$)},null,512),[[R,n.value]]),a[5]||(a[5]=g("（结果为布尔值） ")),t.value.kind=="ok"?(m(),h("div",W,[g(" 随机变量："+y(t.value.args.join(", ")),1),a[1]||(a[1]=f("br",null,null,-1)),a[2]||(a[2]=g(" 对应的 JS 代码：")),f("code",null,y(t.value.expr),1)])):(m(),h("div",q," 解析错误："+y(t.value.e),1)),a[6]||(a[6]=f("hr",null,null,-1)),f("button",{type:"button",onClick:c,disabled:t.value.kind=="err"},"开始测试",8,K),f("button",{type:"button",onClick:r,disabled:s.value==null},"停止测试",8,z),f("div",null,y(s.value?"正":"不")+"在运行，已执行 "+y(i.value)+" 次测试。 ",1),u.value!=null?(m(),h("div",G,[a[3]||(a[3]=g(" 测试发现问题，参数： ")),f("ul",null,[(m(!0),h(N,null,C(u.value,($,p)=>(m(),h("li",null,[f("code",null,y(o.value[p])+" = "+y(Object.is(-0,$)?"-0":String($)),1)]))),256))])])):(m(),h("div",H," 测试暂未发现问题 "))],64))}}),ee=JSON.parse('{"title":"浮点数性质测试","description":"","frontmatter":{"title":"浮点数性质测试"},"headers":[],"relativePath":"project/numtest.md","filePath":"project/numtest.md"}'),Y={name:"project/numtest.md"},te=Object.assign(Y,{setup(e){return(n,o)=>{const t=B("ClientOnly");return m(),h("div",null,[o[0]||(o[0]=V("<p>随机生成数据，测试浮点数的性质。</p><p>在下方输入表达式，点击「开始测试」，程序将会自动测试！点击「停止测试」将会停止。如果测试发现表达式不成立，将会自动停止，并给出「随机变量」的取值。</p><p>表达式与 JavaScript 表达式类似，支持数字、变量、运算符、函数调用。通过「对应的 JS 代码」可以了解表达式的效果。如果表达式输入错误，「解析错误」将会给出提示。</p><ul><li>数字支持 <code>NaN</code>、<code>Infinity</code>。</li><li>变量除了 <code>E</code> 和 <code>PI</code> 是数学常量外，其他将会作为「随机变量」，由程序随机生成。</li><li>只支持一部分数学和逻辑运算符。为了方便，<code>^</code> 是 <code>**</code> 的语法糖，<code>=</code> 是 <code>Object.is</code> 的语法糖，<code>==</code> 是 <code>===</code> 的语法糖。</li><li>运算符优先级与 JavaScript 略有不同。例如，不支持 <code>!=</code>，但可以直接写成 <code>!x = y</code>。</li><li>支持大部分 <code>Math</code> 函数，可以直接调用，如 <code>hypot(3, 4)</code>。</li><li>故意不支持位运算相关运算符和函数。</li></ul><hr>",5)),_(t,null,{default:A(()=>[_(D(Q))]),_:1})])}}});export{ee as __pageData,te as default};
