<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Unicode 常见问题 | ZengYL 的个人主页</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.0.0-rc.28">
    <link rel="preload stylesheet" href="/assets/style.0CbCmbbu.css" as="style">
    
    <script type="module" src="/assets/app.izsgHcX_.js"></script>
    <link rel="modulepreload" href="/assets/chunks/framework.qhbeIQmB.js">
    <link rel="modulepreload" href="/assets/chunks/main.module.lPt_pR9H.js">
    <link rel="modulepreload" href="/assets/chunks/utils.c3f49hEE.js">
    <link rel="modulepreload" href="/assets/blog_unicode.md.4QAAR6c0.lean.js">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="alternate" href="/feed.xml" type="application/atom+xml">
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><!--[--><nav class="_wrapper_nh36t_1"><a href="/"><img class="_icon_nh36t_6" src="/icon.png"></a><div class="_path_nh36t_12"><!--[--><!--[--><span class="_sep_nh36t_20">/</span><a href="/blog/">blog</a><!--]--><!--]--><span class="_sep_nh36t_20">/</span><span>unicode.html</span><!----></div></nav><header class="_header_1fvfa_1"><h1 class="_title_1fvfa_16">Unicode 常见问题</h1><!--[--><div class="_info_1fvfa_19">创建于 12/6/2023</div><!--]--><p class="_info_1fvfa_19 italic">实际会遇到的坑</p></header><main class="_main_1d91h_1"><div style="position:relative;"><div><p>编程中，字符串一般使用 Unicode。但是，绝大部分人并不了解 Unicode，常常犯一些低级错误。本文列出一些问题，都常在实际情况下遇到。不讲过于技术性或理论性的东西，因为我不懂。</p><p>本文也为我自己备忘。和绝大部分人一样，我也不了解 Unicode，本文可能有错误。</p><h2>资料</h2><p>这个术语表很好用，简洁明了：<a href="https://www.unicode.org/glossary/" target="_blank" rel="noreferrer">Glossary</a>。</p><p>或者直接看<a href="https://www.unicode.org/versions/Unicode15.0.0/UnicodeStandard-15.0.pdf" target="_blank" rel="noreferrer">标准</a>（文件很大！）。</p><h2>字符</h2><p>字符类型常常<strong>不是</strong>一般认知的字符。</p><p>以下几种通常用作字符类型：</p><ol><li><em>Code unit</em>。通常是 <em>UTF-16</em> 的，也就是十六位无符号整数。也有 <em>UTF-8</em> 的，八位。</li><li><em>Code point</em>。0 到 10FFFF 的整数。</li><li><em>Scalar value</em>。<em>Code point</em> 去除代理字符，也就是 0 到 D7FF，或 E000 到 10FFFF。</li></ol><p>Java 使用第一种。Haskell 使用第二种。Rust 使用第三种。<br> 偶尔还有用 <em>grapheme cluster</em> 的，那更符合一般认知。</p><h2>字符串</h2><p>标准的字符串表示 <em>scalar value</em> 序列，表示为 <em>code unit</em> 序列。</p><p>字符串类型通常使用 <em>UTF-16</em> 或 <em>UTF-8</em>。许多使用 <em>UTF-16</em> 的语言（如 JavaScript）允许字符串格式错误，也就等同于十六位无符号整数序列（非正式名称 <em>WTF-16</em>）。</p><h2>字符串操作</h2><p>正确的字符串连接后依然正确，切分则不一定。<em>WTF-16</em> 随便怎么弄都依然是 <em>WTF-16</em>。</p><p>正确的字符串，首尾切除若干 <em>code unit</em> 后，若把一个字符切两半就会错误。但是，正确与否一定可以检测出来，即便错误，也一定可以剔除错误部分，不会连累其他字符，也不会多出莫名其妙的字符。不过 <em>WTF-16</em> 不行。</p><p>字符串匹配（子串查找）可以直接在 <em>code unit</em> 层面进行，如果字符串格式正确，结果也正确。</p><p>字符串的相等比较，应当正规化：<code>NFC</code>、<code>NFD</code>、<code>NFKC</code>、<code>NFKD</code>。正规化是上下文相关的，转换后连接不等于连接后转换。</p><h2>字符操作</h2><p>通过字符串的下标访问 <em>scalar value</em> 或者 <em>code point</em>，通常是线性复杂度的。如果复杂度很低，一般说明访问的其实是 <em>code unit</em>。</p><p>一般<strong>不需要</strong>通过字符串的下标访问字符（例如 <em>scalar value</em>）。如果用到了，一般说明方案不好。建议使用字符串匹配，或者正则表达式。</p><p>要获取字符串中的字符，建议获取 <em>grapheme cluster</em>。这通常都是最佳方案，例如在翻转字符串时。</p><p>绝对不要自己处理字符的性质，包括但不限于大小写的转换和判断。例如语法解析，可以用 <code>Xid_Start</code> 之类的来解析标识符。</p><h2>大小写转换</h2><p>大小写转换会改变长度。</p><p>大小写转换是上下文相关的，转换后连接不等于连接后转换。</p><p>大小写转换可以是本地化的，不同地区转换结果可以不同。</p><p>转过去再转回来，不等于原来的（废话）。转过去再转回来再转过去，不等于直接转过去。</p><p>大小写无关形式应当使用专门的 <code>toCasefold</code> 方法，不要转成大写或小写。</p><p>如果要规范化，<code>NFC</code> 或 <code>NFD</code> 规范化应当在 <code>toCasefold</code> 前后各进行一遍，进而是幂等的。例如 <code>NFD(toCasefold(NFD(x)))</code>。</p></div></div></main><!--]--></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blog_cssfont.md\":\"XxLheiFD\",\"blog_reflect.md\":\"OnzONI0m\",\"blog_unicode.md\":\"4QAAR6c0\",\"blog_fenix.md\":\"lfF7zJP0\",\"blog_pinyin.md\":\"NjcUn-a9\",\"blog_rustleetcode65.md\":\"kxV2rBpo\",\"project_schdsc_index.md\":\"kK7iiH5x\",\"blog_ji.md\":\"5Fa7_BIk\",\"blog_open.md\":\"iRrRTvTS\",\"blog_variable.md\":\"lGr5b4wW\",\"project_schdsc_introduction.md\":\"EZo7erhv\",\"blog_jsonstringify.md\":\"7CuwkY89\",\"blog_justnotepad.md\":\"ekCC4voL\",\"blog_webcodecs.md\":\"X3Cnf0Ch\",\"about.md\":\"Gsq43Rg6\",\"blog_bf2wasm.md\":\"ieOz8xPk\",\"index.md\":\"pJVZFm-G\",\"project_index.md\":\"-Gmf1BkO\",\"blog_index.md\":\"FT5qOXjB\",\"blog_curry.md\":\"En1qxDEC\",\"blog_tryinc.md\":\"ulPhdyaI\",\"project_schdsc_wiki.md\":\"9Zb9Teo6\",\"project_scmidi.md\":\"lugSnI7k\",\"project_schdsc_updatelog.md\":\"i--z7ED9\",\"blog_rectarea.md\":\"4RJYuZYN\",\"blog_jqunwrapinner.md\":\"WWA1nt2J\",\"blog_userliteral.md\":\"o13tZsmE\",\"project_schdsc_poster_0-9-0.md\":\"FI2g-1H0\",\"blog_cssgrid.md\":\"89guESat\",\"blog_xizaoguilun.md\":\"5SrWaySO\",\"blog_rustlink.md\":\"TWmUXyaA\",\"blog_wechatlink.md\":\"utLdRXRq\",\"blog_jsforof.md\":\"5DVwGj0g\",\"project_bf2wasm.md\":\"-CGtZDgz\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"ZengYL 的个人主页\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>